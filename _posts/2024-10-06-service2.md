---
layout: post
title: KANS3) Service 2
category:
  - study
tags:
  - study
---

# service
## kube-proxy
### ipvs proxy mode

ì§€ë‚œ ì£¼ì— ì“´ ê²ƒê³¼ ê°™ì´, kube-proxyì˜ iptables proxy modeì—ì„œ ë¬´ìˆ˜í•œ ê·œì¹™ ìˆ˜ë¡œ ì¸í•´ ì§€ì—°ì´ ë°œìƒí•˜ëŠ” ë“±ì˜ ë‹¨ì ì´ ìˆì–´ ipvs proxy modeê°€ ë‚˜ì˜¤ê²Œ ë˜ì—ˆë‹¤.  ì»¤ë„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì§ì ‘ íŠ¸ë˜í”½ì„ ê´€ë¦¬í•˜ì—¬ iptables proxy modeë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ë‹¤. 

ipvs(ip virtual server)ëŠ” 4ê³„ì¸µì—ì„œ ë¶€í•˜ë¶„ì‚°ìœ¼ë¡œ ì‹¤í–‰ë˜ê¸° ìœ„í•´ ë‹¨ì¼ vipë¥¼ ì œê³µí•˜ëŠ” ê¸°ìˆ ë¡œ, kube-proxyì—ì„œ ipvs modeë¡œ ì‚¬ìš©í•˜ê²Œë˜ë©´, svc ì— ì—°ê²°ëœ endpoint ipë“¤ë¡œ íŠ¸ë˜í”½ì´ ë¶„ë°°ë˜ë„ë¡ ê·œì¹™ì´ ë§Œë“¤ì–´ì ¸ì„œ ë™ì‘í•œë‹¤.

ë¶€í•˜ë¶„ì‚° ê·œì¹™ì— ë”°ë¼ ë¶„ì‚°ë˜ëŠ” ê²ƒ ë§ê³ ë„ ë‹¤ë¥¸ì ì´ ìˆë‹¤. iptablesëŠ” ë¬´ì¡°ê±´ ìœ„ì—ì„œë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ê·œì¹™ì„ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ê·œì¹™ì´ ëŠ˜ì–´ë‚  ìˆ˜ë¡ ì¡°íšŒê°€ ì¦ê°€í•˜ëŠ” ë°˜ë©´, ipvsëŠ” í•´ì‹œí…Œì´ë¸” ê¸°ë°˜ìœ¼ë¡œ ê·œì¹™ì„ ê´€ë¦¬ í•˜ê¸° ë•Œë¬¸ì— ê·œì¹™ì´ ì•„ë¬´ë¦¬ ë§ì•„ë„ í•œ ë²ˆë§Œ ì¡°íšŒí•˜ë©´ ëœë‹¤. [ğŸ”—](https://www.tigera.io/blog/comparing-kube-proxy-modes-iptables-or-ipvs/)
ê·¸ë ‡ë‹¤ê³  iptablesë¥¼ ì•„ì˜ˆ ì•ˆì“°ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. NodePort íŠ¸ë˜í”½ ì²˜ë¦¬ë‚˜ ë„¤íŠ¸ì›Œí¬ ì •ì±… í•„í„°ë§ ë“± ì¼ë¶€ ê·œì¹™ì€ iptablesì—ì„œ ê´€ë¦¬ëœë‹¤. ì•„ë˜ í…ŒìŠ¤íŠ¸ì—ì„œ ì¢€ë” ìì„¸í•˜ê²Œ ì‚´í´ë³´ê¸°ë¡œ..


# í…ŒìŠ¤íŠ¸
## ì„¤ì¹˜

ì‹¤ìŠµ í™˜ê²½ì€ ê°€ì‹œë‹¤ë‹˜ì´ ì œê³µí•´ì£¼ì‹  ì•„ë˜ ìŠ¤íƒ íŒŒì¼ ì‚¬ìš©í•´ì„œ ec2ì— ì˜¬ë ¤ ì‹¤ìŠµí–ˆë‹¤. ì´ë²ˆì—ë„ ë™ì¼í•˜ê²Œ kindnet cnië¥¼ ì‚¬ìš©í•œë‹¤.
$ curl -O https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/kans/kans-5w.yaml

```
root@MyServer:~# cat <<EOT> kind-svc-2w-ipvs.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
featureGates:
  "InPlacePodVerticalScaling": true
  "MultiCIDRServiceAllocator": true
nodes:
- role: control-plane
  labels:
    mynode: control-plane
    topology.kubernetes.io/zone: ap-northeast-2a
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
  - containerPort: 30004
    hostPort: 30004
  kubeadmConfigPatches:
  - |
    kind: ClusterConfiguration
    apiServer:
      extraArgs:
        runtime-config: api/all=true
    controllerManager:
      extraArgs:
        bind-address: 0.0.0.0
    etcd:
      local:
        extraArgs:
          listen-metrics-urls: http://0.0.0.0:2381
    scheduler:
      extraArgs:
        bind-address: 0.0.0.0
  - |
    kind: KubeProxyConfiguration
    metricsBindAddress: 0.0.0.0
    ipvs:
      strictARP: true
- role: worker
  labels:
    mynode: worker1
    topology.kubernetes.io/zone: ap-northeast-2a
- role: worker
  labels:
    mynode: worker2
    topology.kubernetes.io/zone: ap-northeast-2b
- role: worker
  labels:
    mynode: worker3
    topology.kubernetes.io/zone: ap-northeast-2c
networking:
  podSubnet: 10.10.0.0/16
  serviceSubnet: 10.200.1.0/24
  kubeProxyMode: "ipvs"        
EOT

root@MyServer:~# kind create cluster --config kind-svc-2w-ipvs.yaml --name myk8s --image kindest/node:v1.31.0
Creating cluster "myk8s" ...
...
Thanks for using kind! ğŸ˜Š

# ì§€ë‚œì£¼ì™€ ë™ì¼í•˜ê²Œ, ì»¨íŠ¸ë¡¤í”Œë ˆì¸ê³¼ ì›Œì»¤ë…¸ë“œì— í•„ìš”í•œ íˆ´ë“¤ ì„¤ì¹˜
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it myk8s-control-plane sh -c 'apt update && apt install tree psmisc lsof wget bsdmainutils bridge-utils net-tools dnsutils ipset ipvsadm nfacct tcpdump ngrep iputils-ping arping git vim arp-scan -y'
(âˆ|kind-myk8s:N/A) root@MyServer:~# for i in worker worker2 worker3; do echo ">> node myk8s-$i <<"; docker exec -it myk8s-$i sh -c 'apt update && apt install tree psmisc lsof wget bsdmainutils bridge-utils net-tools dnsutils ipset ipvsadm nfacct tcpdump ngrep iputils-ping arping -y'; echo; done

# ip ëŒ€ì—­ëŒ€ í™•ì¸
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl get cm -n kube-system kubeadm-config -oyaml | grep -i subnet
      podSubnet: 10.10.0.0/16
      serviceSubnet: 10.200.1.0/24
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl get nodes -o custom-columns='NODE_NAME:.metadata.name,POD_CIDR:.spec.podCIDR'
NODE_NAME             POD_CIDR
myk8s-control-plane   10.10.0.0/24
myk8s-worker          10.10.2.0/24
myk8s-worker2         10.10.1.0/24
myk8s-worker3         10.10.3.0/24
```

## í™˜ê²½ êµ¬ê²½
ipvs modeë¡œ ì„¤ì •í•œ ë¶€ë¶„ í™•ì¸

```
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl describe cm -n kube-system kube-proxy
...
ipvs:
  excludeCIDRs: null
  # ipvs proxyê°€ ê±´ë“œë¦¬ë©´ ì•ˆë˜ëŠ” ëŒ€ì—­ëŒ€
  minSyncPeriod: 0s
  # ipvs ê·œì¹™ ì¬ë™ê¸°í™” ì£¼ê¸° 
  # 0s: serviceë‚˜ endpointSliceë³€ê²½ ì‹œ ì¦‰ì‹œ ì¬ë™ê¸°í™”
  scheduler: ""
  # ipvs ë¶„ì‚° ìœ í˜• (ê¸°ë³¸ê°’ round robin)
  strictARP: true
  # trueì¼ ë•Œ, arp ê´€ë ¨ ì„¤ì •ì„ ì—„ê²©í•˜ê²Œ ì ìš©
  # arp_ignoreì™€ arp_announceê°€ í™œì„±í™”ë¨
  syncPeriod: 0s
  # ë‹¤ì–‘í•œ ì¬ë™ê¸°í™”, ì •ë¦¬ ì‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ” ë¹ˆë„
  tcpFinTimeout: 0s
  # finì„ ìˆ˜ì‹ í•œ ipvs tcp ì„¸ì…˜ íƒ€ì„ ì•„ì›ƒ ì„¤ì •
  tcpTimeout: 0s
  # ìœ íœ´ ipvs tcp ì„¸ì…˜ íƒ€ì„ ì•„ì›ƒ ì„¤ì •
  udpTimeout: 0s
  # ipvs udp íŒ¨í‚·ì— ëŒ€í•´ íƒ€ì„ ì•„ì›ƒ ì„¤ì •
mode: ipvs
...


# .ipvs.strictARP: true ë¡œ ì„¤ì •ì‹œ, ì•„ë˜ ë‘ ê°’ì´ ëª¨ë“  ë…¸ë“œì—ì„œ ë³€ê²½ë¨
# arp_ignore: ë…¸ë“œê°€ arp ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì„ ì œì–´í•˜ëŠ” íŒŒë¼ë¯¸í„°(íŠ¸ë˜í”½ì´ ì ì ˆí•œ ì¸í„°í˜ì´ìŠ¤ì— ë¼ìš°íŒ…ë˜ë„ë¡ ë„ì™€ì¤€ë‹¤.)
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it  myk8s-control-plane   sysctl net.ipv4.conf.all.arp_ignore
net.ipv4.conf.all.arp_ignore = 1
# arp_announce: ë…¸ë“œê°€ arp ì‘ë‹µ ì „ì†¡í•˜ëŠ” ë°©ì‹ì„ ì œì–´(ì˜ëª»ëœ ì¸í„°í˜ì´ìŠ¤ì—ì„œ arp ì‘ë‹µ ì „ì†¡ ë°©ì§€)
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it  myk8s-control-plane  sysctl net.ipv4.conf.all.arp_announce
net.ipv4.conf.all.arp_announce = 2
```


ë‚´ë¶€ í™•ì¸

```
# ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ kube-ipvs0 í™•ì¸ ê°€ëŠ¥í•˜ë‹¤. 
# dummyë¼ê³  ë˜ì–´ìˆìœ¼ë©° ipë„ ë‘ê°œ í• ë‹¹ë˜ì–´ìˆë‹¤. 
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it myk8s-worker ip -d -c addr show kube-ipvs0
2: kube-ipvs0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default
    link/ether ba:f0:1b:0a:e2:16 brd ff:ff:ff:ff:ff:ff promiscuity 0  allmulti 0 minmtu 0 maxmtu 0
    dummy numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536
    inet 10.200.1.1/32 scope global kube-ipvs0
       valid_lft forever preferred_lft forever
    inet 10.200.1.10/32 scope global kube-ipvs0
       valid_lft forever preferred_lft forever


# ìœ„ì˜ ì¸í„°í˜ì´ìŠ¤ê°€ ëª¨ë“  ë…¸ë“œì— ìˆê³  ipê°€ ë™ì¼í•˜ë‹¤. 
(âˆ|kind-myk8s:N/A) root@MyServer:~# for i in control-plane worker worker2 worker3; do echo ">> node myk8s-$i <<"; docker exec -it myk8s-$i ip -br -c addr show kube-ipvs0; echo; done
>> node myk8s-control-plane <<
kube-ipvs0       DOWN           10.200.1.1/32 10.200.1.10/32

>> node myk8s-worker <<
kube-ipvs0       DOWN           10.200.1.1/32 10.200.1.10/32

>> node myk8s-worker2 <<
kube-ipvs0       DOWN           10.200.1.10/32 10.200.1.1/32

>> node myk8s-worker3 <<
kube-ipvs0       DOWN           10.200.1.1/32 10.200.1.10/32


# ì´ ì•„ì´í”¼ë“¤ì€ ëˆ„êµ¬ëƒë©´.. svc cluster ip
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl get svc -A
NAMESPACE     NAME                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes   ClusterIP   10.200.1.1    <none>        443/TCP                  7h3m
kube-system   service/kube-dns     ClusterIP   10.200.1.10   <none>        53/UDP,53/TCP,9153/TCP   7h3m




# ipvsë¥¼ êµ¬ì„±í•˜ëŠ” ë„êµ¬ì¸ ipvsadmë¡œ í™•ì¸
# ipvsì—ì„œ í˜„ì¬ ì„¤ì •ëœ ë¶€í•˜ë¶„ì‚° ê·œì¹™ì„ í™•ì¸í•´ë³´ë©´, ì–´ëŠ ë…¸ë“œë¥¼ í•˜ë“  ì—°ê²° ìˆ˜ ë¶€ë¶„ì„ ì œì™¸í•˜ê³  ë˜‘ê°™ì´ ë°˜í™˜ë¨ 
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it myk8s-worker ipvsadm -L -n
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  10.200.1.1:443 rr
  -> 172.18.0.4:6443              Masq    1      3          0
TCP  10.200.1.10:53 rr
  -> 10.10.0.2:53                 Masq    1      0          0
  -> 10.10.0.3:53                 Masq    1      0          0
TCP  10.200.1.10:9153 rr
  -> 10.10.0.2:9153               Masq    1      0          0
  -> 10.10.0.3:9153               Masq    1      0          0
UDP  10.200.1.10:53 rr
  -> 10.10.0.2:53                 Masq    1      0          0
  -> 10.10.0.3:53                 Masq    1      0          0


(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl get no -o custom-columns='NODE_NAME:.metadata.name,NODE_IP:.status.addresses[?(@.type=="InternalIP")].address'
NODE_NAME             NODE_IP
myk8s-control-plane   172.18.0.4
myk8s-worker          172.18.0.5
myk8s-worker2         172.18.0.2
myk8s-worker3         172.18.0.3
```

ê°€ì¥ ìœ„ì˜ ê·œì¹™ì„ ë³´ë©´

 TCP  10.200.1.1:443 rr
  -> 172.18.0.4:6443   

10.200.1.1ì€ default svcë¡œ í•´ë‹¹ ì„œë¹„ìŠ¤ ipë¡œ ìš”ì²­ì‹œ, 172.18.0.4ì¸ controlplane nodeì˜ 6443í¬íŠ¸(kubernetes api ì„œë²„ê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸)ë¡œ ì „ë‹¬ëœë‹¤. rrì€ roundrobinì„ ì˜ë¯¸í•˜ë©°, ì–´ë–»ê²Œ ë¶„ì‚° ì²˜ë¦¬ë¥¼ í•  ê²ƒì¸ì§€ ì •í•  ìˆ˜ê°€ ìˆë‹¤. (ë¬¼ë¡  ì—¬ê¸°ì„œëŠ” ì—”ë“œí¬ì¸íŠ¸ê°€ í˜¼ìë‹ˆê¹Œ ë¶„ì‚°ë˜ì§€ ì•ŠëŠ”ë‹¤.)



## í…ŒìŠ¤íŠ¸ 

### í…ŒìŠ¤íŠ¸ pod,svc(clusterIP) ìƒì„±

```
# ë°±ì—”ë“œê°€ ë  íŒŒë“œë“¤
(âˆ|kind-myk8s:N/A) root@MyServer:~# cat backend.yaml
apiVersion: v1
kind: Pod
metadata:
  name: webpod1
  labels:
    app: webpod
spec:
  nodeName: myk8s-worker
  containers:
  - name: container
    image: traefik/whoami
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: webpod2
  labels:
    app: webpod
spec:
  nodeName: myk8s-worker2
  containers:
  - name: container
    image: traefik/whoami
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: webpod3
  labels:
    app: webpod
spec:
  nodeName: myk8s-worker3
  containers:
  - name: container
    image: traefik/whoami
  terminationGracePeriodSeconds: 0
  
# ë°±ì—”ë“œ ì•ë‹¨ì— ìˆì„ svc
(âˆ|kind-myk8s:N/A) root@MyServer:~# cat svc4backend.yaml
apiVersion: v1
kind: Service
metadata:
  name: svc-clusterip
spec:
  ports:
    - name: svc-webport
      port: 9000        # svc port
      targetPort: 80    # target(pod) port 
  selector:
    app: webpod         
  type: ClusterIP       
  
# í…ŒìŠ¤íŠ¸ ì‹œ ì‚¬ìš© í•  íŒŒë“œ
(âˆ|kind-myk8s:N/A) root@MyServer:~# cat testpod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: net-pod
spec:
  nodeName: myk8s-control-plane
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
```

### ë™ì‘ í™•ì¸

```
# svc ìƒì„± í›„, ë§¨ ë§ˆì§€ë§‰ì— 10.200.1.216/32ê°€ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸
# ëª¨ë“  ë…¸ë“œì— ë™ì¼í•˜ê²Œ ì¶”ê°€ë˜ì–´ ìˆìŒ
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it myk8s-worker ip -d -c addr show kube-ipvs0
2: kube-ipvs0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default
    link/ether ba:f0:1b:0a:e2:16 brd ff:ff:ff:ff:ff:ff promiscuity 0  allmulti 0 minmtu 0 maxmtu 0
    dummy numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536
    inet 10.200.1.1/32 scope global kube-ipvs0
       valid_lft forever preferred_lft forever
    inet 10.200.1.10/32 scope global kube-ipvs0
       valid_lft forever preferred_lft forever
    inet 10.200.1.216/32 scope global kube-ipvs0
       valid_lft forever preferred_lft forever

# ì¶”ê°€ëœ 10.200.1.216/32ì€ ìƒˆë¡œ ë§Œë“  svc ip
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl get svc -A
NAMESPACE     NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
default       kubernetes      ClusterIP   10.200.1.1     <none>        443/TCP                  9h
default       svc-clusterip   ClusterIP   10.200.1.216   <none>        9000/TCP                 16m
kube-system   kube-dns        ClusterIP   10.200.1.10    <none>        53/UDP,53/TCP,9153/TCP   9h


# ipvsadmìœ¼ë¡œ í˜„ì¬ ë¶„ì‚° ê·œì¹™ í™•ì¸
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it myk8s-worker ipvsadm -L -n
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
...
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0

# svc ipì— ì§€ì •í–ˆë˜ 9000ë²ˆ í¬ë“œë¡œ ë“¤ì–´ì˜¬ ì‹œ, ê° íŒŒë“œì˜ 80ìœ¼ë¡œ ê°€ë„ë¡ ê·œì¹™ì´ ì„¤ì •ë˜ì–´ìˆë‹¤.
# í˜„ì¬ ë¶€í•˜ ë¶„ì‚° ë°©ì‹ì€ ê¸°ë³¸ê°’ì€ round robinìœ¼ë¡œ ë˜ì–´ìˆë‹¤.
```

```
# net-pod(10.10.0.5)ì—ì„œ svc(10.200.1.216:9000 -> 10.10.2.2:80)í˜¸ì¶œ
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl exec -it net-pod -- curl -s --connect-timeout 1 10.200.1.216:9000
Hostname: webpod1


# worker nodeì—ì„œ tcpdump ë– ë³´ë©´..
root@myk8s-worker:/# tcpdump
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on veth42459b76, link-type EN10MB (Ethernet), snapshot length 262144 bytes
# podì˜ gatewayì¸ 10.10.2.1ì´ pod(10.10.2.2) mac ì£¼ì†Œë¥¼ ë¬¼ì–´ë³´ê³ 
19:38:28.346837 ARP, Request who-has ip-10-10-2-2.ap-northeast-2.compute.internal tell ip-10-10-2-1.ap-northeast-2.compute.internal, length 28
19:38:28.347027 ARP, Reply ip-10-10-2-2.ap-northeast-2.compute.internal is-at 9e:d3:48:0e:08:a9 (oui Unknown), length 28
# ì „ë‹¬ë˜ë©´, test pod(10.10.0.5)ì—ì„œ í˜¸ì¶œì´ ì˜ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
19:38:28.347030 IP ip-10-10-0-5.ap-northeast-2.compute.internal.43140 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [S], seq 3445453562, win 64240, options [mss 1460,sackOK,TS val 4260853262 ecr 0,nop,wscale 7], length 0
19:38:28.347045 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-0-5.ap-northeast-2.compute.internal.43140: Flags [S.], seq 587243439, ack 3445453563, win 65160, options [mss 1460,sackOK,TS val 3976301545 ecr 4260853262,nop,wscale 7], length 0
19:38:28.347104 IP ip-10-10-0-5.ap-northeast-2.compute.internal.43140 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 4260853262 ecr 3976301545], length 0
19:38:28.347184 IP ip-10-10-0-5.ap-northeast-2.compute.internal.43140 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [P.], seq 1:81, ack 1, win 502, options [nop,nop,TS val 4260853262 ecr 3976301545], length 80: HTTP: GET / HTTP/1.1
19:38:28.347202 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-0-5.ap-northeast-2.compute.internal.43140: Flags [.], ack 81, win 509, options [nop,nop,TS val 3976301545 ecr 4260853262], length 0
19:38:28.348365 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-0-5.ap-northeast-2.compute.internal.43140: Flags [P.], seq 1:310, ack 81, win 509, options [nop,nop,TS val 3976301547 ecr 4260853262], length 309: HTTP: HTTP/1.1 200 OK
...
```

```
# ê·¸ë ‡ë‹¤ë©´, ë¶€í•˜ë¶„ì‚° ì—­í• ì„ ì˜ í• ì§€.. ë¹„ìœ¨ì„ í™•ì¸í•´ë³´ì•˜ë‹¤.
(âˆ|kind-myk8s:N/A) root@MyServer:~# kubectl exec -it net-pod -- zsh -c "for i in {1..1000}; do curl -s 10.200.1.216:9000 | grep Hostname; done | sort | uniq -c | sort -nr"
    334 Hostname: webpod2
    333 Hostname: webpod3
    333 Hostname: webpod1

# ì¼ì •í•˜ê²Œ ì˜ ê°„ë‹¤...
(âˆ|kind-myk8s:N/A) root@MyServer:~# for i in control-plane worker worker2 worker3; do echo ">> node myk8s-$i <<"; docker exec -it myk8s-$i ipvsadm -Ln -t  10.200.1.216:9000 --rate ; echo; done
>> node myk8s-control-plane <<
Prot LocalAddress:Port                 CPS    InPPS   OutPPS    InBPS   OutBPS
  -> RemoteAddress:Port
TCP  10.200.1.216:9000                  36      215      143    14326    18815
  -> 10.10.1.2:80                       12       72       48     4786     6294
  -> 10.10.2.2:80                       12       72       48     4770     6261
  -> 10.10.3.2:80                       12       72       48     4770     6261
  
  
# ë‚´ë¶€ì—ì„œ í†µì‹ í•˜ëŠ”ê±°ë¼ natë˜ì§„ ì•ŠëŠ”ë‹¤.
root@myk8s-worker:/# conntrack -L --src 10.10.0.5 
tcp      6 104 TIME_WAIT src=10.10.0.5 dst=10.10.2.2 sport=47602 dport=80 src=10.10.2.2 dst=10.10.0.5 sport=80 dport=47602 [ASSURED] mark=0 use=1
tcp      6 104 TIME_WAIT src=10.10.0.5 dst=10.10.2.2 sport=47626 dport=80 src=10.10.2.2 dst=10.10.0.5 sport=80 dport=47626 [ASSURED] mark=0 use=1
tcp      6 104 TIME_WAIT src=10.10.0.5 dst=10.10.2.2 sport=47576 dport=80 src=10.10.2.2 dst=10.10.0.5 sport=80 dport=47576 [ASSURED] mark=0 use=1
```


### í…ŒìŠ¤íŠ¸ svcë¥¼ nodePortë¡œ ë³€ê²½

```
# ê¸°ì¡´ svcë¥¼ nodePortë¡œ ë³€ê²½í•˜ì˜€ë‹¤.
(âˆ|kind-myk8s:N/A) root@MyServer:~#  cat svc-clusterip.yaml
apiVersion: v1
kind: Service
metadata:
  name: svc-clusterip
spec:
  ports:
    - name: svc-webport
      port: 9000        
      targetPort: 80    
      nodePort: 30001
  selector:
    app: webpod         
  type: NodePort
  
(âˆ|kind-myk8s:N/A) root@MyServer:~# k apply -f svc-clusterip.yaml
service/svc-clusterip configured
(âˆ|kind-myk8s:N/A) root@MyServer:~# k get svc
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
kubernetes      ClusterIP   10.200.1.1     <none>        443/TCP          11h
svc-clusterip   NodePort    10.200.1.216   <none>        9000:30001/TCP   108m


# ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— mypc containerë¥¼ ìƒì„±
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker run -d --rm --name mypc --network kind nicolaka/netshoot sleep infinity
29ed3db401ca06fe9148205fd75d992b122afd7566c876e66f79cbb98c946f21
(âˆ|kind-myk8s:N/A) root@MyServer:~# docker exec -it 29 zsh
 # ë‹¹ì—°íˆ clusterIPë¡œëŠ” ì ‘ê·¼ ì•ˆëœë‹¤.
 29ed3db401ca î‚° ~ î‚° curl 10.200.1.216:9000
 
 # nodeIP:ndePortë¡œ ì ‘ê·¼
 # containerIP(172.18.0.6) -> workerNodeIP:nodePort(172.18.0.5:30001 -> 10.10.2.2:80)
 29ed3db401ca î‚° ~ î‚° curl 172.18.0.5:30001
Hostname: webpod1
IP: 127.0.0.1
IP: ::1
IP: 10.10.2.2
IP: fe80::9cd3:48ff:fe0e:8a9
RemoteAddr: 10.10.2.1:14677
GET / HTTP/1.1
Host: 172.18.0.5:30001
User-Agent: curl/8.7.1
Accept: */*


# worker ë…¸ë“œì—ì„œ tcpdump
# podì˜ gwì¸ 10.10.2.1 ì—ì„œ pod(10.10.2.2)ë¡œ íŒ¨í‚·ì´ ê°„ë‹¤.
root@myk8s-worker:/# tcpdump
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on veth42459b76, link-type EN10MB (Ethernet), snapshot length 262144 bytes
20:58:59.432284 IP ip-10-10-2-1.ap-northeast-2.compute.internal.17574 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [S], seq 1880576606, win 64240, options [mss 1460,sackOK,TS val 1217925696 ecr 0,nop,wscale 7], length 0
20:58:59.432303 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-2-1.ap-northeast-2.compute.internal.17574: Flags [S.], seq 3103781959, ack 1880576607, win 65160, options [mss 1460,sackOK,TS val 1094814017 ecr 1217925696,nop,wscale 7], length 0
20:58:59.432380 IP ip-10-10-2-1.ap-northeast-2.compute.internal.17574 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 1217925697 ecr 1094814017], length 0
20:58:59.432483 IP ip-10-10-2-1.ap-northeast-2.compute.internal.17574 > ip-10-10-2-2.ap-northeast-2.compute.internal.http: Flags [P.], seq 1:80, ack 1, win 502, options [nop,nop,TS val 1217925697 ecr 1094814017], length 79: HTTP: GET / HTTP/1.1
20:58:59.432491 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-2-1.ap-northeast-2.compute.internal.17574: Flags [.], ack 80, win 509, options [nop,nop,TS val 1094814017 ecr 1217925697], length 0
20:58:59.432966 IP ip-10-10-2-2.ap-northeast-2.compute.internal.http > ip-10-10-2-1.ap-northeast-2.compute.internal.17574: Flags [P.], seq 1:309, ack 80, win 509, options [nop,nop,TS val 1094814017 ecr 1217925697], length 308: HTTP: HTTP/1.1 200 OK
...


# í…ŒìŠ¤íŠ¸í•œ ì»¨í…Œì´ë„ˆ(mypc)ë¥¼ ì¶œë°œì§€ë¡œ ì¡ê³  conntractë¥¼ ë³´ë©´..
# ë‹¤ë¥¸ ì›Œì»¤ ë…¸ë“œì— ìˆëŠ” íŒŒë“œì—ì„œ ì˜¤ëŠ” ì¹œêµ¬ë“¤ì˜ dstë¥¼ ë³´ê²Œë˜ë©´, myk8s-workerì˜ node ipì´ë‹¤.
# ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ë‹¤ë¥¸ ë…¸ë“œì— ìˆëŠ” íŒŒë“œë¡œ ì „ë‹¬ì‹œ, node ipë¡œ snat ë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.
root@myk8s-worker:/# conntrack -L --src 172.18.0.6
tcp      6 83 TIME_WAIT src=172.18.0.6 dst=172.18.0.5 sport=34212 dport=30001 src=10.10.1.2 dst=172.18.0.5 sport=80 dport=29038 [ASSURED] mark=0 use=1
tcp      6 85 TIME_WAIT src=172.18.0.6 dst=172.18.0.5 sport=34232 dport=30001 src=10.10.2.2 dst=10.10.2.1 sport=80 dport=17574 [ASSURED] mark=0 use=1
tcp      6 38 TIME_WAIT src=172.18.0.6 dst=172.18.0.5 sport=55212 dport=30001 src=10.10.2.2 dst=10.10.2.1 sport=80 dport=14677 [ASSURED] mark=0 use=1
tcp      6 84 TIME_WAIT src=172.18.0.6 dst=172.18.0.5 sport=34218 dport=30001 src=10.10.3.2 dst=172.18.0.5 sport=80 dport=4766 [ASSURED] mark=0 use=1

```

```
# ipvsadm ë¶„ì‚°í…Œì´ë¸”ì— ì¨ìˆëŠ”ê±¸ë¡œ í™•ì¸í–ˆë‹¤.
# nodeIP:nodePortë‘ clusterIP:Portë§Œ ìƒê°í–ˆëŠ”ë°..
root@myk8s-worker:/#  ipvsadm -L -n
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  172.18.0.5:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.10.2.1:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
...


# gwë¡œë§Œ ìƒê°í–ˆë˜.. ì € ipë¡œ í˜¸ì¶œí•´ë³´ë©´, cluster ipì²˜ëŸ¼ ë‚´ë¶€ì—ì„œ í˜¸ì¶œì´ ëœë‹¤.
(âˆ|kind-myk8s:N/A) root@MyServer:~#  k exec net-pod -it -- curl 10.10.2.1:30001
Hostname: webpod1
IP: 127.0.0.1
IP: ::1
IP: 10.10.2.2
IP: fe80::9cd3:48ff:fe0e:8a9
RemoteAddr: 10.10.2.1:23003
GET / HTTP/1.1
Host: 10.10.2.1:30001
User-Agent: curl/8.7.1
Accept: */*


# ë‹¤ë¥¸ ë…¸ë“œë“¤ì˜ ê²½ìš°ë„ ë™ì¼í•˜ê²Œ ë¶„ì‚°í…Œì´ë¸”ì— ê° gw ipê°€ ë“¤ì–´ê°€ ìˆë‹¤. 
(âˆ|kind-myk8s:N/A) root@MyServer:~# for i in control-plane worker worker2 worker3; do echo ">> node myk8s-$i <<"; docker exec -it myk8s-$i ipvsadm -Ln; echo; done
>> node myk8s-control-plane <<
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  172.18.0.4:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.10.0.1:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
...

>> node myk8s-worker <<
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  172.18.0.5:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.10.2.1:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
...

>> node myk8s-worker2 <<
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  172.18.0.2:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.10.1.1:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
...


>> node myk8s-worker3 <<
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port Scheduler Flags
  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  172.18.0.3:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.10.3.1:30001 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
TCP  10.200.1.216:9000 rr
  -> 10.10.1.2:80                 Masq    1      0          0
  -> 10.10.2.2:80                 Masq    1      0          0
  -> 10.10.3.2:80                 Masq    1      0          0
...
```

ê° podì˜ gwê°€ ë¿Œë ¤ì£¼ëŠ” ê²ƒì¸ì§€.. ì˜ëª¨ë¥´ê² ë‹¤. ì´ì— ëŒ€í•´ì„œ ë¬¸ì„œë‚˜ ë‚´ìš©ì„ ëª»ì°¾ì•„ì„œ ë”ì´ìƒ í™•ì¸í•´ë³´ì§€ëŠ” ëª»í–ˆë‹¤. ê·¸ëƒ¥ ë‚´ ì§¤ë§‰í•œ ì§€ì‹ìœ¼ë¡œ ìƒê°ì„ í•´ë³´ìë©´..
podì˜ gatewayê°€ ipvs ëª¨ë“œì—ì„œ nodePort ë¡œ ì„œë¹„ìŠ¤í•˜ê²Œë˜ë©´, ì´ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•´ì£¼ê¸° ìœ„í•´ì„œ ì¤‘ê°„ì—ì„œ snatí•˜ì—¬ ë‚´ë¶€ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ê²ƒ ê°™ë‹¤. 

TCP  172.18.0.5:30001 rr
  -> 10.10.1.2:80   
  -> 10.10.2.2:80  
  -> 10.10.3.2:80    

ì´ë ‡ê²Œ ë˜ì–´ìˆì§€ë§Œ, tcpdumpë¡œ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ 10.10.2.1ì„ í•œë²ˆ ê±°ì³ì„œ ê°€ëŠ” ê²ƒìœ¼ë¡œ ì´í•´ëœë‹¤.

TCP  172.18.0.5:30001 rr
  -> TCP  10.10.2.1:30001 rr
  -> 10.10.1.2:80   
  -> 10.10.2.2:80  
  -> 10.10.3.2:80
  
  
## iptable í™•ì¸

```
# ipvs proxy modeì—ì„œëŠ” iptables ì‘ì„± í•  ë•Œ, ipsetì„ ì‚¬ìš©í•œë‹¤. ê²¹ì¹˜ëŠ” ê·œì¹™ë“¤ì€ ë°˜ë³µí•´ì„œ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•˜ë‚˜ì˜ ê·œì¹™ì— ê·¸ë£¹ì²˜ëŸ¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. 
# ì™¸ë¶€ì—ì„œ ë…¸ë“œí¬íŠ¸ë¥¼ í˜¸ì¶œí•´ì„œ íŒŒë“œë¡œ ë„ë‹¬í•œë‹¤ëŠ” ê°€ì •ìœ¼ë¡œ Iptableì„ ë”°ë¼ê°€ë³´ë©´.. 

# ë”°ë¼ê°ˆ ê·œì¹™ -j KUBE-SERVICES 
root@myk8s-worker:/# iptables -t nat -S | grep PREROUTING
-P PREROUTING ACCEPT
-A PREROUTING -m comment --comment "kubernetes service portals" -j KUBE-SERVICES
-A PREROUTING -d 172.18.0.1/32 -j DOCKER_OUTPUT

# ë”°ë¼ê°ˆ ê·œì¹™ -j KUBE-NODE-PORT
# -m set --match-set KUBE-CLUSTER-IP dst,dst ì´ë¶€ë¶„ì„ ë³´ë©´, KUBE-CLUSTER-IP ipsetì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
root@myk8s-worker:/# iptables -t nat -S | grep KUBE-SERVICES
-N KUBE-SERVICES
-A PREROUTING -m comment --comment "kubernetes service portals" -j KUBE-SERVICES
-A OUTPUT -m comment --comment "kubernetes service portals" -j KUBE-SERVICES
-A KUBE-SERVICES -s 127.0.0.0/8 -j RETURN
-A KUBE-SERVICES ! -s 10.10.0.0/16 -m comment --comment "Kubernetes service cluster ip + port for masquerade purpose" -m set --match-set KUBE-CLUSTER-IP dst,dst -j KUBE-MARK-MASQ
-A KUBE-SERVICES -m addrtype --dst-type LOCAL -j KUBE-NODE-PORT
-A KUBE-SERVICES -m set --match-set KUBE-CLUSTER-IP dst,dst -j ACCEPT


# ipsetì„ í™•ì¸í•´ë³´ë©´ svc clusterIP 
root@myk8s-worker:/# ipset list KUBE-CLUSTER-IP
Name: KUBE-CLUSTER-IP
Type: hash:ip,port
Revision: 7
Header: family inet hashsize 1024 maxelem 65536 bucketsize 12 initval 0x72343c95
Size in memory: 456
References: 3
Number of entries: 5
Members:
10.200.1.10,tcp:9153
10.200.1.10,udp:53
10.200.1.216,tcp:9000
10.200.1.1,tcp:443
10.200.1.10,tcp:53
```

-A KUBE-SERVICES ! -s 10.10.0.0/16 -m comment --comment "Kubernetes service cluster ip + port for masquerade purpose" -m set --match-set KUBE-CLUSTER-IP dst,dst -j KUBE-MARK-MASQ
ê·¸ëŸ¼ ì´ ê·œì¹™ì€ ì¶œë°œì§€ ëŒ€ì—­ì´ 10.10.0.0/16 ëª©ì ì§€ IPê°€ svc clusterIPê°€ ì•„ë‹ˆë¼ë©´ KUBE-MARK-MASQë¡œ ê°€ì„œ ë§ˆìŠ¤ì»¤ë ˆì´ë”© ë˜ì–´ì•¼í•œë‹¤ëŠ” ëœ»ì´ë‹¤. 


```
# ë”°ë¼ê°ˆ ê·œì¹™ -j KUBE-MARK-MASQ
root@myk8s-worker:/# iptables -t nat -S | grep  KUBE-NODE-PORT
-N KUBE-NODE-PORT
-A KUBE-NODE-PORT -p tcp -m comment --comment "Kubernetes nodeport TCP port for masquerade purpose" -m set --match-set KUBE-NODE-PORT-TCP dst -j KUBE-MARK-MASQ
-A KUBE-SERVICES -m addrtype --dst-type LOCAL -j KUBE-NODE-PORT

# ìƒì„±ë˜ì–´ìˆëŠ” ë…¸ë“œ í¬íŠ¸ 30001ì´ ë©¤ë²„ë¡œ ë“¤ì–´ê°€ ìˆë‹¤.
root@myk8s-worker:/# ipset list KUBE-NODE-PORT-TCP
Name: KUBE-NODE-PORT-TCP
Type: bitmap:port
Revision: 3
Header: range 0-65535
Size in memory: 8264
References: 1
Number of entries: 1
Members:
30001
```

-A KUBE-NODE-PORT -p tcp -m comment --comment "Kubernetes nodeport TCP port for masquerade purpose" -m set --match-set KUBE-NODE-PORT-TCP dst -j KUBE-MARK-MASQ 
ìœ„ì˜ ê·œì¹™ì„ íƒ€ê³  node ipë¡œ snatë˜ì–´ì„œ ipvsë¥¼ íƒ€ê²Œ ëœë‹¤. ê·¸ë˜ì„œ ìœ„ì—ì„œ conntract í™•ì¸í•´ë´¤ì„ë•Œ, íŒŒë“œê°€ ë‹¤ë¥¸ ë…¸ë“œì— ìˆëŠ” ê²½ìš° ë“¤ì–´ê°”ë˜ ë…¸ë“œì˜ ipë¡œ snatë˜ì–´ ë‚´ë¶€ì—ì„œ í†µì‹ ëœ ê²ƒì„ í™•ì¸í–ˆë‹¤. íŒŒë“œê°€ ìœ„ì¹˜í•œ ë…¸ë“œë¡œ ë“¤ì–´ê°„ ê²½ìš°ëŠ” ë…¸ë“œì˜ ipë¡œ snatë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìì‹ ì´ ì•„ëŠ” ë„¤íŠ¸ì›Œí¬ì´ê¸° ë•Œë¬¸ì— arp í†µì‹ ì„ ì²˜ìŒì— í•˜ì§€ ì•Šê³ ,  10.10.2.1ë¡œ snatë˜ì–´ ë°”ë¡œ íŒŒë“œì˜ 10.10.2.2ë¡œ íŒ¨í‚·ì´ ì „ë‹¬ëœë‹¤. ì´ëŠ” strictARPë¥¼ trueë¡œ ì„¤ì •í•˜ë©´ì„œ arp_ignore ê°’ì´ í™œì„±í™” ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.


