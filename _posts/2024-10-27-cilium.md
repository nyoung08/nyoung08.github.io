---
layout: post
title: kans3) cilium에 관하여
category: 
  - study
tags:
  - study
---


# cilium

기존의 쿠버네티스에서의 네트워크 통신은 모두 user space까지 들어가서 iptables를 통해야만 했다.  그래서 설치하고 보면, 수많은 iptables 규칙이 있고 pod를 하나 생성하는 것에 따라 수많은 규칙이 생기게 되었다. (calico cni 설치해서 확인해봤을떄에는 120개 가량의 필터가 늘었었음) 또 iptables 특성상 위에서부터 일치하는 규칙에 패킷을 전달하게 되기 때문에 복잡도가 확 늘어난다. 그래서 이전에 kube-proxy에서 ipvs proxy mode가 등장하게 된 것도 이 때문이였고 kube-proxy를 사용하지 않고 ebpf를 사용하는 cilium도 등장하게 되었다.


## ebpf

ebpf는 확장된 bpf(Berkeley Packet Filter)로 레지스터 등이 증가하여 기존의 bpf보다 성능이 좋아졌다. [🔗](https://docs.kernel.org/bpf/classic_vs_extended.html)
bpf는 커널 코드에 훅을 걸어 동작한다. 찾아봤을 때, 패킷을 분석하고 필터링하기 위해 설계되었던 것이고, 커널 내부에서 하나의 샌드박스와 같은 환경(in-kernel virtual machine)에서 실행된다. iptables는 규칙에 따라 user space에서 패킷을 열심히 처리하지만, bpf는 커널레벨에서 수행되기 때문에 보다 빠르게 패킷이 처리된다.


작성중

